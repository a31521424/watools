# CLAUDE.md - WaTools Development Guide

This file provides Claude Code with essential context about the WaTools project for effective development assistance.

## Project Overview

**WaTools** is a cross-platform desktop application launcher built with **Wails v2** (Go backend + React/TypeScript frontend). It provides a command palette-style interface for launching applications and executing system operations via global hotkeys, inspired by uTools and Alfred.

## Architecture

### Backend (Go)
- **Framework**: Wails v2 for desktop app development
- **Language**: Go 1.23+
- **Database**: SQLite with sqlc for type-safe queries
- **Platform**: Currently macOS-focused with cross-platform potential

### Frontend (React/TypeScript)
- **Framework**: React 19 with TypeScript
- **Build Tool**: Vite 6.3.4
- **Package Manager**: Yarn 1.22.22
- **Styling**: Tailwind CSS 4
- **UI Components**: shadcn/ui, cmdk (command palette)

## Key Components

### Core Application (`internal/app/`)
- `app.go`: Main application lifecycle management
- `hotkey.go`: Global hotkey registration and handling
- Singleton pattern with window management

### Command System (`internal/command/`)
- `command.go`: Command execution engine
- `application/`: Application discovery and launching
- `operator/`: System operation commands
- `watcher/`: File system monitoring for app changes

### Database (`pkg/db/`)
- `wa_db.go`: Database connection and migration management
- `pkg/db/queries/*` + `query.sql.go`: SQL queries (generated by sqlc)
- `migrations/`: Database schema migrations
- Uses embedded migrations with `go:embed` for portable binaries

### Models (`pkg/models/`)
- `command.go`: Core command interfaces and types
- Command categories: Application vs Operation commands

### Frontend (`frontend/src/`)
- `components/watools/`: Main application components
- `api/command.ts`: Backend communication
- `lib/search.ts`: Fuzzy search with Fuse.js and Pinyin support

## Development Workflow

### Setup Commands
```bash
# Install dependencies
cd frontend && npm install && cd ..

# Development mode (with hot reload)
wails dev

# Production build
wails build

# Frontend development only
cd frontend && npm run dev
```

### Database Operations
```bash
# Generate SQL code (after modifying pkg/db/queries/*)
sqlc generate

# Create new migration
migrate create -ext sql -dir pkg/db/migrations -seq migration_name
```

### Testing
```bash
# Run Go tests
go test ./...

# Run frontend tests
cd frontend && npm test
```

## Key Technologies

### Backend Dependencies
- `github.com/wailsapp/wails/v2`: Desktop framework
- `modernc.org/sqlite`: Pure Go SQLite driver
- `github.com/golang-migrate/migrate/v4`: Database migrations
- `github.com/rs/zerolog`: Structured logging
- `github.com/fsnotify/fsnotify`: File system watching
- `golang.design/x/hotkey`: Global hotkey support

### Frontend Dependencies
- `react@19`: UI framework
- `@types/react`, `typescript`: Type safety
- `tailwindcss`: Utility-first CSS
- `cmdk`: Command palette component
- `fuse.js`: Fuzzy search engine
- `pinyin-pro`: Chinese character search
- `lucide-react`: Icon system

## Important File Patterns

### Go Code Structure
- `internal/`: Private application code
- `pkg/`: Reusable packages
- `config/`: Configuration management
- Platform-specific files use `_darwin.go`, `_windows.go` suffixes

### Frontend Structure
- `src/components/ui/`: Base UI components (shadcn/ui)
- `src/components/watools/`: Application-specific components
- `src/hooks/`: Custom React hooks
- `src/lib/`: Utility functions and configurations

## Configuration

### Build Configuration
- `wails.json`: Wails project configuration
- `go.mod`: Go module dependencies
- `package.json`: Frontend dependencies and scripts
- `tailwind.config.ts`: Tailwind CSS configuration

### Database Configuration
- `sqlc.yaml`: SQL code generation settings
- Migrations in `pkg/db/migrations/`

## Platform-Specific Notes

### macOS (Primary Target)
- Uses Cocoa APIs for application discovery
- Global hotkey integration with macOS
- File system monitoring for `/Applications` and `~/Applications`

### Cross-Platform Considerations
- Platform-specific code isolated in separate files
- Wails handles cross-platform window management
- Database and core logic platform-agnostic

## Common Tasks

### Adding New Commands
1. Define command in `pkg/models/command.go`
2. Implement runner interface
3. Register in appropriate command group
4. Update frontend components if needed

### Database Changes
1. Create migration in `pkg/db/migrations/`
2. Update `pkg/db/queries/*`
3. Run `sqlc generate`
4. Update Go code to use new queries

### Frontend Updates
1. Modify components in `src/components/watools/`
2. Update API calls in `src/api/`
3. Test with `wails dev`

## Troubleshooting

### Common Issues
- **Migration errors**: Check `go:embed` path and file permissions
- **Hotkey conflicts**: macOS System Preferences may override
- **Build failures**: Ensure Go 1.23+ and Node.js 18+ installed
- **Frontend errors**: Clear `frontend/dist` and rebuild

### Debugging
- Use `wails dev` for development with devtools
- Check logs via zerolog structured output
- Frontend debugging available in browser devtools

## Code Style

### Go
- Follow standard Go conventions
- Use structured logging with zerolog
- Implement proper error handling
- Use context.Context for cancellation

### TypeScript/React
- Use TypeScript strict mode
- Follow React hooks patterns
- Use Tailwind for styling
- Implement proper component composition

This guide should help Claude Code understand the project structure and provide effective development assistance.